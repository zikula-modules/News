<?php
/**
 * News.
*
* @copyright Michael Ueberschaer (MU)
* @license http://www.gnu.org/licenses/lgpl.html GNU Lesser General Public License
* @author Michael Ueberschaer <info@homepages-mit-zikula.de>.
* @link https://homepages-mit-zikula.de
* @link https://ziku.la
* @version Generated by ModuleStudio (https://modulestudio.de).
*/

namespace MU\NewsModule\Helper;

use MU\NewsModule\Helper\Base\AbstractControllerHelper;

/**
 * Helper implementation class for controller layer methods.
 */
class ControllerHelper extends AbstractControllerHelper
{
    /**
     * @inheritDoc
     */
    protected function determineDefaultViewSorting($objectType)
    {
        $request = $this->requestStack->getCurrentRequest();
        $repository = $this->entityFactory->getRepository($objectType);
    
        $sort = $request->query->get('sort', '');
        $sortdir = '';
        if (empty($sort) || !in_array($sort, $repository->getAllowedSortingFields())) {
            $sort = $repository->getDefaultSortingField();

            $defaultSorting = $this->variableApi->get('MUNewsModule', 'defaultMessageSorting', 'articledatetime');
            $defaultSortingDirection = $this->variableApi->get('MUNewsModule', 'sortingDirection', 'descending');
            $sortdir = str_replace('ending', '', $defaultSortingDirection);
            if ($defaultSorting == 'articleID') {
                $sort = 'id';
            } elseif ($defaultSorting == 'articledatetime') {
                $sort = 'createdDate';
            } elseif ($defaultSorting == 'articleweight') {
                $sort = 'weight';
            } elseif ($defaultSorting == 'articlestartdate') {
                $sort = 'startDate';
            }

            $request->query->set('sort', $sort);
            // set default sorting in route parameters (e.g. for the pager)
            $routeParams = $request->attributes->get('_route_params');
            $routeParams['sort'] = $sort;
            $request->attributes->set('_route_params', $routeParams);
        }
        if ('' === $sortdir) {
            $sortdir = $request->query->get('sortdir', 'ASC');
            if (false !== strpos($sort, ' DESC')) {
                $sort = str_replace(' DESC', '', $sort);
                $sortdir = 'desc';
            }
        }

        return [$sort, $sortdir];
    }
}
